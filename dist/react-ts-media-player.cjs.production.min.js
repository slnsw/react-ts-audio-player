"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=(e=require("react"))&&"object"==typeof e&&"default"in e?e.default:e,n=function(e){var n=e.config,a=e.children,r=[].concat((void 0===n?{}:n).classNames["sr-only"]||[]);return t.createElement("span",{className:r.join(" ")},a)},a=function(e){var a=e.enabled,r=void 0===a||a,i=e.hidden,c=void 0!==i&&i,l=e.btnType,o=e.onClick,u=e.children,s=e.config,d=void 0===s?{}:s,f=[e.className||""].concat(d.classNames[l]||[]),m=[].concat(d.icons[l]||[]),v=d.icons[l]||null;return t.createElement("button",{className:f.join(" "),disabled:!r,hidden:c,onClick:o},t.createElement(n,{config:d},u),!v&&t.createElement("span",{className:m.join(" ")}),v)},r=function(e){if("number"==typeof e.nativeEvent.offsetX)return e.nativeEvent.offsetX;if("object"==typeof e.targetTouches){var t=e,n=t.target.getBoundingClientRect();return t.targetTouches[0].pageX-n.left}return 0},i=function(e){var n=e.defaultValue,a=void 0===n?0:n,i=e.className,c=e.onClick,l=t.useRef(null),o=t.useState(a),u=o[0],s=o[1],d=t.useState(0),f=d[0],m=d[1],v=t.useState(!1),g=v[0],p=v[1];t.useEffect((function(){s(a)}),[a]),t.useEffect((function(){if(g){var e=f/l.current.clientWidth;s(100*e),"function"==typeof c&&c(e)}}),[g,f]);var E=function(e){p(!0),m(r(e))},b=function(){return p(!1)};return t.createElement("div",{className:[i||""].join(" "),onMouseDown:E,onMouseUp:b,onMouseMove:function(e){g&&m(r(e))},onTouchStart:E,onTouchEnd:b,onTouchMove:function(e){g&&m(r(e))},ref:l},t.createElement("div",{className:[i+"__fill"].join(" "),style:{width:u+"%"}},t.createElement("span",{className:"sr-only"},u+" percent")))},c=function(e){var n,a=e.visible,r=void 0===a||a,i=e.lang,c=e.tracks,l=void 0===c?[]:c,o=e.id,u=e.className,s=t.useState(""),d=s[0],f=s[1],m=t.useState(null),v=m[0],g=m[1],p=function(e){var t,n,a=e.target.activeCues,r="";for(n=0;n<a.length;n+=1)void 0!==(t=a[n]).text&&(r+=t.text);f(r)};return t.useEffect((function(){return v&&v.addEventListener("cuechange",p,!1),function(){v&&v.removeEventListener("cuechange",p,!1)}}),[(n=v,n?[n.kind,n.mode,n.language,n.cues.length].join(","):"")]),t.useEffect((function(){if(i&&i.length&&l&&l.length){var e,t=null;for(e=0;e<l.length;e+=1)if(l[e].language===i){t=l[e];break}g(t)}}),[i,l]),t.createElement("div",{className:[u||"","video-wrapper__subtitle-container"].join(" "),hidden:!r,"aria-hidden":!r,lang:i,id:o,"aria-atomic":"true","aria-live":"polite","aria-relevant":"additions text"},r?d:" ")},l=function(e){var n=e.id,a=e.visible,r=void 0!==a&&a,i=e.children;return t.createElement("ol",{className:["video-wrapper__popup-menu",e.className||""].join(" "),id:n,hidden:!r,"aria-expanded":r},i)},o=function(e){var n=e.selected,a=e.onSelect;return t.createElement("li",null,t.createElement("button",{"data-value":e.value,"data-state":void 0!==n&&n?"active":"inactive",onClick:a,onKeyUp:function(e){"Enter"===e.key&&a(e)}},e.label))},u=function(e){var n,a,r=e.visible,i=void 0!==r&&r,c=e.id,u=e.tracks,s=e.selected,d=e.onSelect,f=e.className,m=function(e){var t=e.target.getAttribute("data-value")||null;"function"==typeof d&&d(t)},v=[t.createElement(o,{key:"_none_",label:"Off",value:null,selected:!s,onSelect:m})];if(u&&u.length)for(a=0;a<u.length;a+=1)v.push(t.createElement(o,{key:(n=u[a]).language+"-"+a,label:n.label,value:n.language,selected:s&&n.language===s,onSelect:m}));return t.createElement(l,{className:[f||"","subtitles-menu"].join(" "),id:c,visible:i},v)},s=function(e,t,n,a){return void 0===t&&(t=""),void 0===n&&(n=""),void 0===a&&(a=[]),[].concat(e.split(/\s+/)).concat(t.split(/\s+/)).filter((function(e){return e&&e.length})).map((function(e){return n.length?e+"__"+n:e})).reduce((function(e,t){return e.concat([""].concat(a.filter((function(e){return e&&e.length}))).map((function(e){return t+(e.length?"--"+e:"")})))}),[]).join(" ")},d=function(e){var a=e.enabled,r=void 0===a||a,i=e.hidden,c=void 0!==i&&i,l=e.toggleState,o=void 0!==l&&l,u=e.children,d=e.onClick,f=e.className,m=e.config,v=void 0===m?{}:m,g=(v.classNames[e.btnType]||[]).join(" ");return t.createElement("button",{className:s(g,f||""),disabled:!r,hidden:c,onClick:d},t.createElement(n,{config:v},u),t.createElement("span",{className:s(g,"","icon",["false"]),hidden:o}),t.createElement("span",{className:s(g,"","icon",["false"]),hidden:!o}))},f=function(e){var n=e.tracklist,a=e.selected,r=void 0===a?0:a,i=e.visible,c=void 0!==i&&i,u=e.onSelect,s=e.id,d=e.className,f=function(e){var t=e.target.getAttribute("data-value")||null;if(null!==t){var n=parseInt(t,10);"function"==typeof u&&u(n)}},m=(void 0===n?[]:n).map((function(e,n){return t.createElement(o,{key:n,label:e.label,value:n,selected:n===r,onSelect:f})}));return t.createElement(l,{className:[d||"","track-menu"].join(" "),id:s,visible:c},m)},m=function(e){return e<10?"0"+e:e.toString()},v=function(e){var t=parseInt(e,10),n=Math.floor(t/60),a=t-60*n;return m(n)+":"+m(a)};exports.default=function(e){var n=e.playlist,r=void 0===n?[]:n,l=e.id,o=void 0===l?"audio-player":l,m=e.className,g=e.eventRouter,p=e.crossOrigin,E=e.onEndNextFile,b=void 0!==E&&E,h=e.config,k=void 0===h?{}:h,y=e.singleTrack,N=void 0!==y&&y,T=t.useState([]),S=T[0],_=T[1],w=t.useState(0),C=w[0],j=w[1],x=t.useState(0),M=x[0],R=x[1],U=t.useState("00:00"),F=U[0],O=U[1],L=t.useState(!1),P=L[0],A=L[1],D=t.useState(!1),X=D[0],I=D[1],V=t.useState(!1),q=V[0],B=V[1],K=t.useState(null),W=K[0],z=K[1],G=t.useState(!1),H=G[0],J=G[1],Q=t.useState(!1),Y=Q[0],Z=Q[1],$=t.useState(!1),ee=$[0],te=$[1],ne=o+"__captions",ae=o+"__time-indicator",re=o+"__duration-indicator",ie=o+"__track-list",ce=o+"__subtitle-menu",le=t.useRef(null),oe=t.useRef(null),ue=t.useRef(null);t.useEffect((function(){le.current.setAttribute("playsinline","playsinline")}),[]),t.useEffect((function(){_(r),j(0)}),[r]);var se=C>0,de=C<S.length-1;t.useEffect((function(){le.current.load(),le.current.currentTime=0,R(0)}),[C]);var fe=function(e){A(!1),I(!1),te(!1),j(e)},me=function(e){return e.transcriptUrl&&e.transcriptUrl.length>0},ve=function(){return ee?le.current.textTracks:[]},ge=S&&S.length&&ee,pe=function(e){Z(!1),z(e&&e.length?e:null)},Ee=function(){if(ge){var e=!1;le.current.paused?(le.current.play(),e=!0):le.current.pause(),A(e),O(v(le.current.currentTime)),g&&g.emit("state.playing",e)}},be=function(){de&&fe(C+1)},he=function(){ge&&(le.current.currentTime-=k.rewindTime||5)},ke=function(){ge&&(le.current.currentTime+=k.fastForwardTime||5)},ye=function(){le.current.currentTime=0,I(!1),O(v(le.current.currentTime)),R(0),g&&g.emit("state.ended",!1)};t.useEffect((function(){var e;for(e=0;e<le.current.textTracks.length;e+=1)le.current.textTracks[e].mode=le.current.textTracks[e].language===W?"showing":"hidden"}),[W]);var Ne=function(e){"backward"===e?he():"play_pause"===e?Ee():"reset"===e?ye():"forward"===e&&ke()};t.useEffect((function(){return g&&g.on("remote.action",Ne),function(){g&&g.off("remote.action",Ne)}}),[]);var Te=S[C]||null;return t.createElement("div",{className:s("video-wrapper",m)},t.createElement("audio",{className:s("video-element",m),"data-oh-audio-player":"1",crossOrigin:p,preload:"metadata",ref:le,onLoadedMetadata:function(){te(!0),pe(W)},onEnded:function(){b?de&&(be(),setTimeout((function(){return Ee()}),500)):(I(!0),O(v(le.current.currentTime)),g&&(g.emit("state.playing",!1),g.emit("state.ended",!0)))},onTimeUpdate:function(){le.current.duration>0&&(R(100/le.current.duration*le.current.currentTime),O(v(le.current.currentTime)))},"aria-describedby":ne},Te&&t.createElement("source",{src:Te.audioUrl,type:"audio/mpeg"}),Te&&me(Te)&&t.createElement("track",{src:Te.transcriptUrl,kind:"captions",label:"English",srcLang:"en"})),t.createElement("div",{className:s("video-controls",m)},t.createElement(i,{defaultValue:M,className:"video-controls__progress-bar",onClick:function(e){le.current.currentTime=e*le.current.duration}}),t.createElement("label",{className:"sr-only",htmlFor:ae},"Time elapsed"),t.createElement("input",{className:s("video-controls",m,"time-elapsed"),id:ae,readOnly:!0,ref:ue,value:F}),k.showDuration&&t.createElement(t.Fragment,null,t.createElement("label",{className:"sr-only",htmlFor:re},"Duration"),t.createElement("input",{className:s("video-controls",m,"duration"),id:re,readOnly:!0,ref:oe,value:v(le.current?le.current.duration:0)})),t.createElement("div",{className:"w-100"}),t.createElement("div",{className:s("video-controls",m,"button-wrapper")},t.createElement(d,{btnType:"tracklist","aria-controls":ie,enabled:S.length>0&&!N,onClick:function(){Z(!1),J(!H)},toggleState:H,config:k},"Tracklist"),t.createElement("div",{className:s("video-controls",m,"button-wrapper__space")}),t.createElement(a,{btnType:"previous-audio",enabled:S.length>1&&se,onClick:function(){se&&fe(C-1)},config:k},"Previous track"),t.createElement(a,{btnType:"backward",onClick:he,config:k},"Rewind"),t.createElement(d,{btnType:"play",hidden:X,onClick:Ee,toggleState:P,config:k},P?"Pause":"Play"),t.createElement(a,{btnType:"reset",enabled:X,hidden:!X,onClick:ye,config:k},"Restart"),t.createElement(a,{btnType:"forward",onClick:ke,config:k},"Fast forward"),t.createElement(a,{btnType:"next-audio",enabled:S.length>1&&de,onClick:be,config:k},"Next track"),t.createElement(d,{btnType:"closed-captioning","aria-controls":ce,enabled:ee&&me(Te),onClick:function(){J(!1),Z(!Y)},toggleState:Y,config:k},"Closed captioning"),t.createElement("div",{className:s("video-controls",m,"button-wrapper__space")}),t.createElement(d,{btnType:"mute",onClick:function(){var e=!le.current.muted;le.current.muted=e,B(e)},toggleState:q,config:k},"Mute"))),t.createElement(u,{visible:Y,id:ce,tracks:ve(),selected:W,onSelect:pe}),t.createElement(f,{visible:!N&&H,id:ie,tracklist:S,selected:C,onSelect:function(e){J(!1),fe(e)}}),t.createElement(c,{visible:null!==W,lang:W,tracks:ve(),id:ne}))};
//# sourceMappingURL=react-ts-media-player.cjs.production.min.js.map
